<template>
  <div id="list-view">
    <h1>list view</h1>
    <p>to show all records</p>
    <div>
      <vxe-toolbar>
        <template v-slot:buttons>
          <vxe-button icon="fa fa-refresh" @click="reloadList()"
            >reload</vxe-button
          >
          <vxe-button icon="fa fa-plus" @click="insertEvent()">add</vxe-button>
        </template>
      </vxe-toolbar>
      <vxe-table
        border
        show-header-overflow2
        show-overflow
        highlight-hover-row
        :data="recordslist"
        @cell-dblclick="cellDBLClickEvent"
      >
        <vxe-table-column
          field="title"
          sortable
          title="title"
          :filters="[{ data: '' }]"
          :filter-method="filterMethod"
        >
          <template v-slot:filter="{ $panel, column }">
            <input
              type="type"
              v-for="(option, index) in column.filters"
              :key="index"
              v-model="option.data"
              @input="$panel.changeOption($event, !!option.data, option)"
            />
          </template>
        </vxe-table-column>
        <vxe-table-column
          field="author"
          sortable
          title="author"
          :filters="[{ data: '' }]"
          :filter-method="filterMethod"
        >
          <template v-slot:filter="{ $panel, column }">
            <input
              type="type"
              v-for="(option, index) in column.filters"
              :key="index"
              v-model="option.data"
              @input="$panel.changeOption($event, !!option.data, option)"
            />
          </template>
        </vxe-table-column>
        <vxe-table-column
          field="status"
          sortable
          title="status"
          :formatter="formatstatus"
        ></vxe-table-column>
        <vxe-table-column
          field="updatetime"
          sortable
          title="updatetime"
        ></vxe-table-column>
        <vxe-table-column title="操作" width="100" show-overflow>
          <template slot-scope="{ row }">
            <vxe-button
              type="text"
              icon="fa fa-edit"
              @click="editEvent(row)"
            ></vxe-button>
            <vxe-button
              type="text"
              icon="fa fa-trash-o"
              @click="removeEvent(row)"
            ></vxe-button>
          </template>
        </vxe-table-column>
      </vxe-table>
      <editPopup></editPopup>
    </div>
  </div>
</template>

<script>
import { mapState } from 'vuex'
import 'font-awesome/css/font-awesome.css'
import editPopup from './editPopup.vue'

export default {
  name: 'list',
  components: { editPopup },
  // data () {
  //   return {
  //     submitLoading: false,
  //     selectRow: null,
  //     showEdit: false,
  //     formData: null,
  //     formRules: {
  //       title: [{ required: true, message: 'please enter the book title' }],
  //       author: [{ required: true, message: 'please enter the author' }]
  //     },
  //     formItems: [
  //       {
  //         title: 'book information',
  //         span: 24,
  //         titleAlign: 'left',
  //         titleWidth: 200,
  //         titlePrefix: { icon: 'fa fa-address-card-o' }
  //       },
  //       {
  //         field: 'title',
  //         title: 'title',
  //         span: 12,
  //         itemRender: {
  //           name: '$input',
  //           props: { placeholder: 'please enter the book title' }
  //         }
  //       },
  //       {
  //         field: 'author',
  //         title: 'author',
  //         span: 12,
  //         itemRender: {
  //           name: '$input',
  //           props: { placeholder: 'please enter the author' }
  //         }
  //       },
  //       {
  //         field: 'status',
  //         title: 'status',
  //         span: 12,
  //         itemRender: {
  //           name: '$select',
  //           options: [
  //             { label: '未購入', value: '1' },
  //             { label: '本を購入済み', value: '2' },
  //             { label: 'kindleを購入済み', value: '3' }
  //           ]
  //         }
  //       },
  //       {
  //         align: 'center',
  //         span: 24,
  //         titleAlign: 'left',
  //         itemRender: {
  //           name: '$buttons',
  //           children: [
  //             {
  //               props: { type: 'submit', content: 'submit', status: 'primary' }
  //             },
  //             { props: { type: 'reset', content: 'reset' } }
  //           ]
  //         }
  //       }
  //     ]
  //   }
  // },
  computed: mapState({
    recordslist: (state) => state.records.all,
    selectRow: (state) => state.formData.selectRow,
    showEdit: (state) => state.formData.showEdit,
    formData: (state) => state.formData.formData
  }),
  created () {
    this.$store.dispatch('records/getAllRecords')
  },
  methods: {
    filterMethod ({ option, row }) {
      return String(row.title).startsWith(option.data)
    },
    formatstatus ({ cellValue }) {
      const flag = parseInt(cellValue)
      switch (flag) {
        case 1:
          return '未購入'
        case 2:
          return '本を購入済み'
        case 3:
          return 'kindleを購入済み'
        default:
          return 'undefeat'
      }
    },
    reloadList () {
      this.$store.dispatch('records/getAllRecords')
    },
    cellDBLClickEvent ({ row }) {
      this.editEvent(row)
    },
    insertEvent () {
      this.formData = {
        title: '',
        author: '',
        status: '',
        updatetime: ''
      }
      this.selectRow = null
      this.showEdit = true
    },
    editEvent (row) {
      this.formData = {
        title: row.title,
        author: row.author,
        status: row.status,
        updatetime: row.updatetime
      }
      this.selectRow = row
      this.showEdit = true
    }
    // submitEvent() {
    //   this.submitLoading = true;
    //   setTimeout(() => {
    //     this.submitLoading = false;
    //     this.showEdit = false;
    //     if (this.selectRow) {
    //       // 临时使用insert的api，如果同样的数据应该会覆盖
    //       this.$store.dispatch("records/putRecords", this.formData);
    //       this.$XModal.message({ message: "edit success", status: "success" });
    //     } else {
    //       this.$store.dispatch("records/putRecords", this.formData);
    //       this.$XModal.message({ message: "add success", status: "success" });
    //     }
    //     this.$store.dispatch("records/getAllRecords");
    //   }, 500);
    // },
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
h1,
h2 {
  font-weight: normal;
  margin: 0 50px;
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}
#list-view {
  margin: 20px;
}
</style>
